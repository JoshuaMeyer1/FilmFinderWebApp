<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmFinder</title>
    <link rel="stylesheet" href="/static/style.css">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/css/toastr.css" rel="stylesheet"/>
      
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/js/toastr.js"></script>
    <!-- Toastr CSS -->
    <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />-->

    <!-- Toastr JS -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>-->

</head>

<body>
    <div class="container">
        <h1 id="filmfinder" style="color:#653239">FilmFinder</h1>

        <form>
            <h3> Query </h3>
            <div>
                <label for="title"><strong>Title:</strong></label>
                <input type="text" id="title" placeholder="Enter title">
                <div id="titleError" class="error"></div>
            </div>

            <div>
                <label for="searchType"><strong>Search Type</strong></label>
                <select id="genreFilter">
                    <option value="plotSummary">Plot Summary</option>
                    <option value="Genre">Genre</option>
                    <option value="keyWords">Key Words</option>
                </select>
            </div>

            <hr style="border: 1px solid #653239; margin: 20px 0;">
            <div>
                <label for="plotSummaryDisp"><strong>Plot Summary:</strong></label>
                <textarea readonly id="plotSummaryDisp" placeholder="Plot summary will display here..."></textarea>
            </div>

            
            <div>
                <label for="genresDisp"><strong>Genre:</strong></label>
                <textarea readonly id="genresDisp" placeholder="Genre will display here..."></textarea>
            </div>

            
            <div>
                <label for="keyWordsDisp:"><strong>Key Words:</strong></label>
                <textarea readonly id="keyWordsDisp" placeholder="Key words will display here..."></textarea>
            </div>


            <button type="button" id="findMovie" onclick="getMovieDetails()">Validate Title</button><!--validate()-->
            <button type="button" id="searchBtn" onclick="showSearchResults()">Search</button>
        </form>
    </div>
    <!--<script src="script.js"></script>-->
</body>

<script>

        //Returns movie details for the queried movie
    async function getMovieDetails() {
        const movieTitle = document.getElementById('title').value;
        const payload = { movieTitle };
        console.log("fetching movie details...");

        try {
            console.log('Sending request to Flask...');
            const response = await fetch('http://127.0.0.1:5000/get-movie-details', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            });

            // Check if the response is OK
            if (!response.ok) {
                //toastr.error('Network response error', 'Error');
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            console.log('Response from Flask:', data);

            // Render the data in the HTML
            const plotSummary = document.getElementById('plotSummaryDisp');
            const genres = document.getElementById('genresDisp');
            const keyWords = document.getElementById('keyWordsDisp');


            if (data.error) {
                //toastr.error('Issue with retrieved data', 'Error');
                //THIS SHOULD CAUSE A TOASTR
                console.log("error with the data");
            } else {
                //toastr.success('Movie data retrieved successfully!', 'Success');

                const strSummary = JSON.stringify(data.summary, null, 2);
                const strGenre = JSON.stringify(data.genres, null, 2);
                const strKeywords = JSON.stringify(data.keywords, null, 2);

                plotSummary.textContent = `${strSummary.slice(1, strSummary.length - 1)}`;
                genres.textContent = `${strGenre.slice(1, strGenre.length - 1)}`;
                keyWords.textContent = `${strKeywords.slice(1, strKeywords.length - 1)}`;
            }
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('result').textContent =
                'An error occurred while fetching the data.';
        };
    }

    //Returns search results
    async function showSearchResults() {
        // open search results page
        window.location.href = 'search_results.html';
    }
    </script>

</html>



